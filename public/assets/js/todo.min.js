(function(){const b="YYYY-MM-DD HH:mm:00";const w="不正な日付です.<br>再入力してください";const j="ユーザ情報が読み取れません.";const g="作成成功しました！";const o="状態が更新されました！";const x="内容が更新されました！";const n="期限が更新されました！";const c="削除成功しました！";var e;var t;function r(){$(".date-time-picker").datetimepicker({format:b,inline:true,sideBySide:true})}function i(){var D=$(this).attr("name");q("DELETE",{id:D},c)}function m(){var D={data:t,schema:[{header:"ID",key:"id",hide:true},{header:"状態",key:"status_description",template:s(p())},{header:"STATUS_CODE",key:"status_code",hide:true},{header:"内容",key:"description",template:'<input type="text" class="table-row-element table-row-description" name="{{id}}" value="{{description}}" maxlength="100"></input>'},{header:"期限",key:"deadline",template:'<input type="text" class="table-row-element table-row-deadline date-time-picker" name="{{id}}" value="{{deadline}}"></input>'},{header:"",key:"",template:'<button type="button" class="table-row-element table-row-delete-button" name="{{id}}"><span class="glyphicon glyphicon-trash"></span></button>'}],paginating:false};if($("#columns").hasClass("columns")){$("#columns").columns("setMaster",t);$("#columns").columns("create")}else{$("#columns").columns(D)}f();r()}function a(D){d(D,"success")}function y(D){d(D,"warning")}function d(E,D){$.toast({text:E,heading:"",showHideTransition:"slide",allowToastClose:true,hideAfter:2000,stack:5,position:"bottom-right",icon:D})}function u(){$.ajax({url:"/rest/todo/list?sort_by=&search_keyword=",dataType:"json",success:function(D){t=D;m()}})}function p(){return{"0":"未完了","10":"作業中","20":"完了","30":"保留"}}function l(){e=$(this).val()}function C(){var D=$(this).closest("tr");D.children().toggleClass("gray-out-table-background");D.children().children().toggleClass("gray-out-child-opacity")}function f(){$.each(t,function(E,G){var H=G.id;var F=$(".table-row-description[name="+H+"]");var D=F.closest("tr").find(".table-row-status");D.attr("name",H);D.val(G.status_code)})}function A(){var E=$("#description").val();var D=$("#deadline").val();if(!h(D)){y(DATE_INPUT_ALLERT_MESSAGE)}q("POST",{description:E,deadline:D},g)}function h(G){var D=moment(G,b);var H=D.isValid();var E=D.format(b);var F=E!="0000-00-00 00:00:00";return H&&F}function s(G){var D=document.createElement("select");D.setAttribute("class","table-row-status form-control table-row-element");for(var H in G){var F=document.createElement("option");F.setAttribute("value",H);F.innerHTML=G[H];D.appendChild(F)}var E=document.createElement("div");E.appendChild(D);return E.innerHTML}function z(){return moment(new Date()).format(b)}function q(F,D,E){$.ajax({type:F,data:D,url:"rest/todo/task",dataType:"json",success:function(G){t=G;u();a(E)}})}function v(){var F=$(this).children();var E=$(this).attr("name");var D=$(this).val();q("PUT",{id:E,status_code:D},o)}function B(){var E=$(this).attr("name");var D=$(this).val();if(D===e){return}q("PUT",{id:E,description:D},x)}function k(){var D=$(this).val();if(!h(D)){y(w);$(this).val(e);return}if(D===e){return}var E=$(this).attr("name");q("PUT",{id:E,deadline:D},n)}$(function(){u();$(".date-today").val(z());r();$(document).on("click","#insert-button",A);$(document).on("click",".table-row-delete-button",i);$(document).on("change",".table-row-status",v);$(document).on("focus",".table-row-description",l);$(document).on("blur",".table-row-description",B);$(document).on("focus",".table-row-deadline",l);$(document).on("blur",".table-row-deadline",k);$(document).on("click",".ui-table-sortable",r);$(document).on("click",".ui-table-sortable",f);$(document).on("keyup",".ui-table-search",r);$(document).on("keyup",".ui-table-search",f)});$.ajaxSetup({statusCode:{401:function(){y(j)}}})})();